@layer base {
  /* ===== Code Blocks & Syntax Highlighting ===== */
  pre:has(code) {
    @apply border border-border;
  }

  .astro-code {
    @apply flex border bg-(--shiki-light-bg) text-(--shiki-light) outline-border [&_span]:text-(--shiki-light);
  }

  html[data-theme="dark"] .astro-code {
    @apply bg-(--shiki-dark-bg) text-(--shiki-dark) [&_span]:text-(--shiki-dark);
  }

  .astro-code code {
    @apply flex-[1_0_100%] bg-inherit p-0;
  }

  .prose code,
  .prose blockquote {
    @apply break-words;
  }

  .prose table code {
    /* add line breaks whenever necessary for codes under table */
    @apply break-all sm:break-normal;
  }

  pre > code {
    white-space: pre;
  }

  /* Light mode syntax highlighting contrast improvements */
  html[data-theme="light"] pre:has(code),
  html[data-theme="light"] pre:has(code) span,
  :root pre:has(code),
  :root pre:has(code) span {
    /* Darken comment colors by ~30% total for better contrast */
    --shiki-color-comment: #495057;
    --shiki-token-comment: #495057;
  }

  /* Override inline styles for comments in light mode */
  html[data-theme="light"] pre code span[style*="color:#6C757D"],
  :root pre code span[style*="color:#6C757D"] {
    color: #495057;
  }

  /* Styles for Shiki transformers */
  /* https://shiki.style/packages/transformers */
  .astro-code {
    .line.diff.add {
      @apply relative inline-block w-full bg-green-400/20 before:absolute before:-left-3 before:text-green-500 before:content-['+'];
    }
    .line.diff.remove {
      @apply relative inline-block w-full bg-red-500/20 before:absolute before:-left-3 before:text-red-500 before:content-['-'];
    }
    .line.highlighted {
      @apply inline-block w-full bg-slate-400/20;
    }
    .highlighted-word {
      @apply rounded-sm border border-border px-0.5 py-px;
    }
  }
}

@layer utilities {
  pre.astro-code {
    background-color: var(--shiki-light-bg);
    color: var(--shiki-light);
  }

  pre.astro-code span {
    color: var(--shiki-light);
  }

  html[data-theme="dark"] pre.astro-code {
    background-color: var(--shiki-dark-bg);
    color: var(--shiki-dark);
  }

  html[data-theme="dark"] pre.astro-code span {
    color: var(--shiki-dark);
  }
}
